INLINE=""
CONFIG=""

while getopts "ic:" option; do
    case ${option} in
        c) CONFIG="$OPTARG";;
        i) INLINE="1";;
    esac
done

if ! test "$CONFIG" ; then
    echo "ERROR: Config not defined."
    echo "Usage: ./run -c configname.elvo [-i]"
    exit 1
fi

source ./config/$CONFIG
if [[ ! -f ./config/$CONFIG ]] ; then
    exit 1
fi

if ! test "$generator" ; then
    echo "ERROR: Key 'generator' not in config."
    exit 1
fi

if ! test "$augment_data" ; then
    echo "ERROR: Key 'augment_data' not in config."
    exit 1
fi

if ! test "$extend_dims" ; then
    echo "ERROR: Key 'extend_dims' not in config."
    exit 1
fi

if ! test "$model" ; then
    echo "ERROR: Key 'model' not in config."
    exit 1
fi

if ! test "$output" ; then
    echo "ERROR: Key 'output' not in config."
    exit 1
fi

if ! test "$dims" ; then
    echo "ERROR: Key 'dims' not in config."
    exit 1
fi

if ! test "$epochs" ; then
    echo "ERROR: Key 'epochs' not in config."
    exit 1
fi

if ! test "$batch_size" ; then
    echo "ERROR: Key 'batch_size' not in config."
    exit 1
fi

if test ! "$INLINE" ; then
    nohup python -u main.py $generator $augment_data $extend_dims \
        $model $dims $epochs $batch_size > results/$output &
else
    python main.py $generator $augment_data $extend_dims \
        $model $dims $epochs $batch_size
fi
